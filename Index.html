<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>運費計算機</title>
  <style>
    body{font-family:Segoe UI, Roboto, 'Noto Sans TC', Arial; padding:18px; max-width:760px;}
    label{display:block; margin-top:8px;}
    input[type="number"], input[type="text"]{width:160px; padding:6px; margin-right:8px;}
    .row{margin-top:6px;}
    #result{margin-top:12px; padding:10px; border:1px solid #ddd; background:#f9f9f9;}
    button{margin-top:12px; padding:8px 14px;}
  </style>
</head>
<body>
  <h2>運費計算機（台灣寄美國）</h2>

  <div>
    <label>長 (cm) <input id="length" type="number" step="0.1" /></label>
    <label>寬 (cm) <input id="width" type="number" step="0.1" /></label>
    <label>高 (cm) <input id="height" type="number" step="0.1" /></label>
    <label>重量 (kg) <input id="weight" type="number" step="0.01" /></label>
    <label>美國收件 Zip code <input id="zip" type="text" /></label>

    <div class="row">
      <button onclick="onCalculate()">計算運費</button>
    </div>
  </div>

  <div id="result"></div>

  <script>
    function show(msg){
      document.getElementById('result').innerHTML = msg;
    }

    function onCalculate(){
      var length = document.getElementById('length').value;
      var width = document.getElementById('width').value;
      var height = document.getElementById('height').value;
      var weight = document.getElementById('weight').value;
      var zip = document.getElementById('zip').value;

      if(!length || !width || !height || !weight || !zip){
        alert('請輸入所有欄位');
        return;
      }
      show('計算中，請稍候…');

      google.script.run.withSuccessHandler(function(res){
        if(!res || !res.success){
          show('計算失敗：' + (res && res.error ? res.error : '未知錯誤'));
          return;
        }
        var html = '<b>計算結果</b><br>';
        html += '材積 (inch 各邊)：' + res.dimsInches.l + ' x ' + res.dimsInches.w + ' x ' + res.dimsInches.h + '（體積='+res.dimsInches.volume+'）<br>';
        html += '材積重: ' + res.dimWeight + ' lb<br>';
        html += '實際重: ' + res.actualWeight + ' lb<br>';
        html += '<b>計費重量: ' + res.billableWeight + ' lb</b><br>';
        html += '台灣→美國國際運費: $' + res.intlCost.toFixed(2) + '<br>';
        html += '服務費: $' + Number(res.serviceFee).toFixed(2) + '<br>';
        html += 'Zip code 分區: ' + (res.zone || '找不到') + '<br>';
        html += '美國國內費用: ' + (res.domesticRate !== undefined && res.domesticRate !== null ? ('$' + Number(res.domesticRate).toFixed(2)) : ('N/A')) + '<br>';
        if(res.domesticNote) html += '<small>備註：' + res.domesticNote + '</small><br>';
        html += '<hr><b>總計: $' + Number(res.total).toFixed(2) + '</b>';
        show(html);
      }).calculateShipping(length, width, height, weight, zip);
    }
  </script>
</body>
</html>
