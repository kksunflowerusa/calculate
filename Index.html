<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>運費計算機</title>
  <style>
    body { font-family: Arial, Helvetica, sans-serif; max-width:760px; margin:30px auto; padding:10px; }
    label { display:block; margin-top:10px; }
    input[type="number"], input[type="text"] { width:160px; padding:6px; }
    button { margin-top:12px; padding:8px 14px; }
    .result { margin-top:16px; padding:12px; border:1px solid #ddd; background:#fafafa; }
    .error { color: #b00; }
  </style>
</head>
<body>
  <h2>B3運費計算機</h2>
  <form id="calcForm">
    <label>長（公分） <input id="length" type="number" step="0.01" required /></label>
    <label>寬（公分） <input id="width" type="number" step="0.01" required /></label>
    <label>高（公分） <input id="height" type="number" step="0.01" required /></label>
    <label>重量（公斤） <input id="weight" type="number" step="0.01" required /></label>
    <label>收件 Zip code（美國） <input id="zip" type="text" required /></label>

    <button type="submit">計算運費</button>
  </form>

  <div id="msg" class="error"></div>
  <div id="out" class="result" style="display:none;"></div>

  <script>
    // TODO: 把下面 URL 換成你 Apps Script 部署得到的 web app URL
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbxc86FR5TGGRvrKOkHct0q2QuAYWf05cneysQdHEmwX6bboJn2DSfHK1JX5dQQWR2sW1g/exec';

    document.getElementById('calcForm').addEventListener('submit', async function(e){
      e.preventDefault();
      document.getElementById('msg').textContent = '';
      document.getElementById('out').style.display = 'none';

      const length = document.getElementById('length').value;
      const width  = document.getElementById('width').value;
      const height = document.getElementById('height').value;
      const weight = document.getElementById('weight').value;
      const zip    = document.getElementById('zip').value.trim();

      if (!length || !width || !height || !weight || !zip) {
        document.getElementById('msg').textContent = '請輸入所有欄位';
        return;
      }

      // 建議用 GET 參數呼叫（避免 preflight），並 encodeURI
      const url = GAS_URL +
        '?length_cm=' + encodeURIComponent(length) +
        '&width_cm='  + encodeURIComponent(width) +
        '&height_cm=' + encodeURIComponent(height) +
        '&weight_kg=' + encodeURIComponent(weight) +
        '&zip='       + encodeURIComponent(zip);

      try {
        const res = await fetch(url);
        const data = await res.json();
        if (data.error) {
          document.getElementById('msg').textContent = '錯誤：' + (data.message || data.error);
          console.error(data);
          return;
        }

        const o = data;
        const r = o.rates;
        const comp = o.computed;
        const html = `
          <strong>分區：</strong> ${o.zone} <br/>
          <strong>計費重量（磅）：</strong> ${comp.billingWeight}（材積：${comp.volumetric_w} / 實重：${comp.actual_w}）<br/>
          <strong>國際運費：</strong> $${r.internationalRate.toFixed(2)} <br/>
          <strong>服務費：</strong> $${r.serviceFee.toFixed(2)} <br/>
          <strong>美國國內運費：</strong> $${r.domesticRate.toFixed(2)} <br/>
          <hr/>
          <strong>總計：</strong> <span style="font-size:1.2em">$${r.total.toFixed(2)}</span>
          ${o.rates.cappedTo100 ? '<div style="color:orange">注意：查表時以 100 磅上限處理</div>' : ''}
        `;
        document.getElementById('out').innerHTML = html;
        document.getElementById('out').style.display = 'block';
      } catch (err) {
        document.getElementById('msg').textContent = '發生錯誤（網路或後端）。';
        console.error(err);
      }
    });
  </script>
</body>
</html>


