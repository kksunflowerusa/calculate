<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>運費計算器</title>
<style>
  body {font-family: Arial, sans-serif; max-width: 600px; margin: 30px auto; padding: 20px;}
  label {display:block; margin-top:10px;}
  input {margin-top:5px; padding:5px; width:100%;}
  button {margin-top:15px; padding:8px 15px;}
  #output {margin-top:20px; padding:10px; border:1px solid #ccc; background:#f9f9f9;}
  #innerBoxes div {margin-top:8px;}
</style>
</head>
<body>
<h2>B5運費計算器</h2>

<!-- 外箱資訊 -->
<label>長 (公分)：<input type="number" id="length" step="0.01"></label>
<label>寬 (公分)：<input type="number" id="width" step="0.01"></label>
<label>高 (公分)：<input type="number" id="height" step="0.01"></label>
<label>重量 (公斤)：<input type="number" id="weight" step="0.01"></label>

<!-- 內箱件數 -->
<label>內箱件數：
  <input type="number" id="innerCount" step="1" min="0" oninput="renderInnerBoxes()">
</label>

<!-- 動態產生每件重量輸入欄位 -->
<div id="innerBoxes"></div>

<button onclick="calculate()">計算金額</button>

<div id="output"></div>

<script>
// 依件數動態生成輸入欄位
function renderInnerBoxes() {
  const count = parseInt(document.getElementById('innerCount').value) || 0;
  const container = document.getElementById('innerBoxes');
  container.innerHTML = '';
  for (let i = 1; i <= count; i++) {
    const div = document.createElement('div');
    div.innerHTML = `內箱第 ${i} 件重量 (公斤)：<input type="number" step="0.01" id="innerWeight${i}">`;
    container.appendChild(div);
  }
}

function calculate() {
  const lengthCm = parseFloat(document.getElementById('length').value) || 0;
  const widthCm  = parseFloat(document.getElementById('width').value)  || 0;
  const heightCm = parseFloat(document.getElementById('height').value) || 0;
  const weightKg = parseFloat(document.getElementById('weight').value) || 0;

  // 無條件進位轉英吋
  const lengthIn = Math.ceil(lengthCm / 2.54);
  const widthIn  = Math.ceil(widthCm  / 2.54);
  const heightIn = Math.ceil(heightCm / 2.54);

  // 材積重與實際重
  const volumetricLb = Math.ceil((lengthIn * widthIn * heightIn) / 139);
  const actualLb = Math.ceil(weightKg / 0.454);
  const chargeableLb = Math.max(volumetricLb, actualLb);

  // 基本運費
  let usdTotal = chargeableLb * (3.99 + 0.8);

  // 額外加費依計費重量
  if (chargeableLb >= 1 && chargeableLb <= 10) {
    usdTotal += 12;
  } else if (chargeableLb >= 11 && chargeableLb <= 20) {
    usdTotal += 6;
  }

  // 內箱計算 (小於1磅加收)
  const innerCount = parseInt(document.getElementById('innerCount').value) || 0;
  let underOneLbCount = 0;
  for (let i = 1; i <= innerCount; i++) {
    const kg = parseFloat(document.getElementById(`innerWeight${i}`).value) || 0;
    const lb = kg / 0.454;
    if (lb < 1) underOneLbCount++;
  }
  usdTotal += underOneLbCount * 5;

  // 顯示結果
  const today = new Date().toLocaleDateString();
  document.getElementById('output').innerHTML = `
    轉換後尺寸：${lengthIn} × ${widthIn} × ${heightIn} 英寸<br>
    材積重：${volumetricLb} 磅<br>
    實際重：${actualLb} 磅<br>
    計費重量：${chargeableLb} 磅<br>
    小於1磅的內箱件數：${underOneLbCount} 件<br>
    運費金額：$${usdTotal.toFixed(2)} 美元<br>
    今日日期：${today}
  `;
}
</script>
</body>
</html>
